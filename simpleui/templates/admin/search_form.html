{% load i18n static %}
{% if cl.search_fields or cl.has_filters %}
<style>
    .multiselect-dropdown {
        border: 1px solid #ccc;
        padding: 10px;
        max-height: 200px;
        overflow-y: auto;
        display: none;
    }
    .filter-toggle-button {
        margin-bottom: 10px;
    }
</style>
<script type="text/javascript">
    function preSubmit() {
        $('#changelist-search').find("input[name!='']").each(function () {
            if ($(this).val() == '') {
                $(this).removeAttr('name');
            }
        });
    }
</script>
<div id="toolbar">
    <form id="changelist-search" method="get" onsubmit="preSubmit(this)">
        <input type="hidden" name="p" value=""/>
        <div class="simpleui-form">
            {% if cl.search_fields %}
            <el-input size="small" class="simpleui-form-item"
                      clearable
                      name="{{ search_var }}"
                      :placeholder="placeholder"
                      prefix-icon="el-icon-search"
                      v-model="searchInput" @keyup.enter.native="formSubmit()">
            </el-input>
            {% endif %}

            {% if cl.has_filters %}
            {% for spec in cl.filter_specs %}
            {% if spec.title == "Categories" %}
            <button class="filter-toggle-button">Toggle Categories Filter</button>
            <div class="multiselect-dropdown">
                <h3>{% blocktrans with filter_title=spec.title %} By {{ filter_title }} {% endblocktrans %}</h3>
                {% for option in spec.lookup_choices %}
                <div>
                    <input type="checkbox"
                           name="{{ spec.parameter_name }}"
                           value="{{ option.0 }}"
                           id="choice{{ forloop.counter }}"
                           {% if option.0 in request.GET.getlist(spec.parameter_name) %} checked {% endif %}>
                    <label for="choice{{ forloop.counter }}">{{ option.1 }}</label>
                </div>
                {% endfor %}
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const dropdown = document.querySelector('.multiselect-dropdown');
                    const toggleButton = document.querySelector('.filter-toggle-button');

                    toggleButton.addEventListener('click', function() {
                        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
                    });

                    dropdown.addEventListener('change', function() {
                        const selected = Array.from(dropdown.querySelectorAll('input[type="checkbox"]:checked'))
                            .map(checkbox => checkbox.name + '=' + checkbox.value)
                            .join('&');

                        window.location.href = window.location.pathname + '?' + selected;
                    });
                });
            </script>
            {% endif %}
            {% endfor %}
            {% endif %}
            <el-button size="small" type="primary" icon="el-icon-search" @click="formSubmit()">{% trans 'Search' %}</el-button>
            {% if show_result_count %}
            <span class="small quiet">{% blocktrans count counter=cl.result_count %}{{ counter }} result{% plural %}{{ counter }} results{% endblocktrans %} (<a href="?{% if cl.is_popup %}_popup=1{% endif %}">{% if cl.show_full_result_count %}{% blocktrans with full_result_count=cl.full_result_count %}{{ full_result_count }} total{% endblocktrans %}{% else %}{% trans "Show all" %}{% endif %}</a>)</span>
            {% endif %}

            {% for pair in cl.params.items %}
            {% if pair.0 != search_var %}
            {% if pair.0.0 == '_' or pair.0 == 'o'%}
            <input type="hidden" name="{{ pair.0 }}" value="{{ pair.1 }}"/>
            {% else %}
            <input type="hidden" class="form-params" data-name="{{ pair.0 }}" value="{{ pair.1 }}"/>
            {% endif %}
            {% endif %}
            {% endfor %}
        </div>
    </form>
</div>
{% else %}
<form id="changelist-search" method="get">
    <input type="hidden" name="p" value=""/>
</form>
{% endif %}
